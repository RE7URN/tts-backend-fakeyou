<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Overlay TTS</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      overflow: hidden;
      background: #0e0e10; /* Fondo oscuro si se abre fuera de OBS */
    }

    #gifHablando {
      position: fixed;
      bottom: 35%;
      left: 50%;
      transform: translateX(-50%);
      width: 180px;
      display: none;
      z-index: 2;
    }

    #mensajeOverlay {
      position: fixed;
      bottom: 15%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.6);
      padding: 1rem 2rem;
      border-radius: 1rem;
      color: #fff;
      font-size: 2rem;
      white-space: pre-wrap;
      text-align: center;
      max-width: 80%;
      opacity: 0;
      transition: opacity 0.4s ease, transform 0.4s ease;
      z-index: 1;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.5);
    }

    #mensajeOverlay.visible {
      opacity: 1;
      transform: translateX(-50%) scale(1.05);
    }

    /* Gu√≠a lateral */
    #guia {
      position: fixed;
      top: 10%;
      right: 20px; /* Antes estaba en 0, ahora dejamos un peque√±o margen */
      width: 280px;
      background-color: rgba(0, 0, 0, 0.75);
      color: white;
      padding: 1rem;
      font-size: 1rem;
      border-radius: 1rem 0 0 1rem;
      box-shadow: -4px 0 12px rgba(0, 0, 0, 0.4);
      z-index: 99;
    }

    #guia h2 {
      font-size: 1.2rem;
      margin-top: 0;
      color: #c084fc;
      text-align: center;
    }

    #guia ol {
      padding-left: 1.2rem;
    }

    #guia li {
      margin-bottom: 0.75rem;
    }

    /* Responsive en m√≥viles */
    @media screen and (max-width: 768px) {
      #guia {
        width: 90%;
        left: 50%;
        right: auto;
        transform: translateX(-50%);
        top: auto;
        bottom: 1rem;
        border-radius: 1rem;
        font-size: 0.9rem;
      }

      #guia h2 {
        font-size: 1rem;
      }

      #guia ol {
        padding-left: 1rem;
      }

      #mensajeOverlay {
        font-size: 1.5rem;
        max-width: 95%;
      }

      #gifHablando {
        width: 140px;
        bottom: 40%;
      }
    }
  </style>
</head>
<body>

  <img id="gifHablando" src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzM5dXVzaXVtMWVncXJmbWtvbmI0MjAwanZrYnVsdndzbXdiZDhqaCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/FMGyadaG0ZKbxi03UB/giphy.gif" alt="GIF hablando" />
  <div id="mensajeOverlay"></div>

  <div id="guia">
    <h2>¬øC√≥mo usar el TTS?</h2>
    <ol>
      <li>Canjea la recompensa "TTS" en el canal de Twitch.</li>
      <li>Escribe tu nombre de usuario en min√∫sculas.</li>
      <li>Elige la voz que prefieras.</li>
      <li>Escribe tu mensaje y env√≠alo.</li>
    </ol>
  </div>

  <script>
    const overlayDiv = document.getElementById("mensajeOverlay");
    const gif = document.getElementById("gifHablando");

    const ws = new WebSocket("wss://ttsfakeyou-joanmibackend-oauth.up.railway.app");

    ws.onopen = () => {
      console.log("üü¢ Conectado al WebSocket del overlay");
    };

    ws.onmessage = async (event) => {
      try {
        const data = JSON.parse(event.data);
        const { text, audioUrl } = data;

        overlayDiv.textContent = text;
        overlayDiv.classList.add("visible");
        gif.style.display = "block";

        const audio = new Audio(audioUrl);
        audio.volume = 1.0;
        audio.play();

        audio.addEventListener("ended", () => {
          overlayDiv.classList.remove("visible");
          gif.style.display = "none";
          overlayDiv.textContent = "";
        });
      } catch (e) {
        console.error("‚ùå Error procesando el mensaje del WebSocket:", e);
      }
    };

    ws.onerror = (error) => {
      console.error("‚ùå Error WebSocket:", error);
    };
  </script>
</body>
</html>
