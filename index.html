<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TTS JoanMiii</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <style>
 body {
  margin: 0;
  padding: 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #0e0e10;
  color: #fff;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  position: relative;
}

.container {
  background-color: #1f1f23;
  padding: 2rem;
  border-radius: 1rem;
  width: 90%;
  max-width: 500px;
  text-align: center;
  box-shadow: none; /* ‚ùå Sin halo morado */
  animation: fadeInUp 0.8s ease forwards;
  min-height: 380px; /* üîí Asegura una altura base para alinear la gu√≠a */
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.guia {
  position: absolute;
  top: 0;
  left: calc(50% + 300px); /* justo a la derecha del centro */
  background-color: rgba(0, 0, 0, 0.8);
  padding: 2rem;
  border-radius: 1rem;
  width: 280px;
  height: auto;
  box-shadow: none;
  animation: fadeInRight 1s ease forwards;
}


h1 {
  font-size: 1.8rem;
  margin-bottom: 1.5rem;
  color: #c084fc;
}

input, select, textarea {
  width: 100%;
  padding: 0.75rem;
  margin: 0.5rem 0;
  background-color: #2e2e33;
  border: 1px solid #555;
  color: #fff;
  border-radius: 0.5rem;
  font-size: 1rem;
}

textarea {
  resize: none;
  height: 100px;
}

button {
  margin-top: 1rem;
  width: 100%;
  padding: 0.75rem;
  font-size: 1rem;
  background-color: #a855f7;
  border: none;
  color: white;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #9333ea;
}

.guia h2 {
  margin-top: 0;
  font-size: 1.2rem;
  color: #c084fc;
  text-align: center;
}

.guia ol {
  padding-left: 1.2rem;
  margin-top: 1rem;
}

.guia li {
  margin-bottom: 0.75rem;
  line-height: 1.5;
}

/* Animaciones */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInRight {
  from {
    opacity: 0;
    transform: translateX(40px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Responsive (movemos la gu√≠a abajo) */
@media (max-width: 768px) {
  .guia {
    position: static;
    width: 90%;
    margin-top: 2rem;
    transform: none;
    left: auto;
    top: auto;
  }

  body {
    flex-direction: column;
    align-items: center;
    overflow-y: auto;
    padding: 2rem 1rem;
  }
}

  </style>
</head>
<body>
  <div class="container">
    <h1>TTS de JoanMiii</h1>
    <input type="text" id="usuario" placeholder="Tu usuario de Twitch" />
    <select id="voz">
      <option value="EL:vqIbpHNnKXv33Ytdhbs2">IlloJuan</option> 
      <option value="EL:wA5XnqHS6bwma6dOu6kL">ElXokas</option>
      <option value="EL:LyhzyjSU5cIDWFSXnxvx">Dheylo</option>
      <option value="EL:LKjU9l8WPQk4DGoxLUGN">Ibai</option>
      <option value="EL:WqhBvLV6sdvMKp6Fh7ZI">Abascal</option>
    </select>
    <textarea id="mensaje" placeholder="Escribe tu mensaje aqu√≠..."></textarea>
    <button onclick="enviar()">Enviar mensaje</button>
  </div>

  <div class="guia">
    <h2>¬øC√≥mo usar el TTS?</h2>
    <ol>
      <li>Canjea la recompensa "TTS" en el canal de Twitch.</li>
      <li>Escribe tu nombre de usuario en min√∫sculas.</li>
      <li>Elige la voz que prefieras.</li>
      <li>Escribe tu mensaje y haz clic en enviar.</li>
    </ol>
  </div>

  <script>
    const BACKEND_URL = "https://ttsfakeyou-joanmibackend-oauth.up.railway.app";

    async function verificarUsuario(username) {
      try {
        const res = await fetch(`${BACKEND_URL}/api/allowed/${username}`);
        const data = await res.json();
        return data.allowed;
      } catch (err) {
        console.error("‚ùå Error en verificarUsuario:", err);
        return false;
      }
    }

    async function consumirPermiso(username) {
      try {
        await fetch(`${BACKEND_URL}/api/consume/${username}`, {
          method: "POST"
        });
      } catch (err) {
        console.error("‚ö†Ô∏è Error al consumir permiso:", err);
      }
    }

    async function enviarMensaje(username, voice, message) {
      try {
        const endpoint = "/api/tts";
        const res = await fetch(`${BACKEND_URL}${endpoint}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, voice, message })
        });

        return res.ok;
      } catch (err) {
        console.error("‚ùå Error en enviarMensaje:", err);
        return false;
      }
    }

    async function enviar() {
      const username = document.getElementById("usuario").value.trim().toLowerCase();
      const message = document.getElementById("mensaje").value;
      const voice = document.getElementById("voz").value;

      if (!username || !message) {
        alert("Por favor, rellena todos los campos.");
        return;
      }

      const permitido = await verificarUsuario(username);
      if (!permitido) {
        alert("No est√°s autorizado. Canjea la recompensa 'TTS' primero.");
        return;
      }

      const enviado = await enviarMensaje(username, voice, message);
      if (enviado) {
        alert("‚úÖ Mensaje enviado con √©xito");
        await consumirPermiso(username);
      } else {
        alert("‚ùå Hubo un error al enviar tu mensaje");
      }
    }
  </script>
</body>
</html>
